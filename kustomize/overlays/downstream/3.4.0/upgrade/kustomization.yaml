# Overlay variant for upgrading to Red Hat Quay "v3.4.0" release.
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization	
commonAnnotations:
  quay-version: v3.4.0
bases:
  - ../../../../tmp
patchesStrategicMerge:
  # Scale the app deployment to 0 pods in order to run all migrations present in the new container image using the "upgrade" deployment.
  - ./quay.deployment.patch.yaml
  - ./upgrade.deployment.patch.yaml
images:
  - name: quay.io/projectquay/quay
    newName: quay.io/redhat/quay
    newTag: v3.4.0
  - name: quay.io/projectquay/clair
    newName: quay.io/redhat/clair
    newTag: v3.4.0
  - name: redis
    newName: registry.access.redhat.com/rhscl/redis-32-rhel7
  - name: postgres
    newName: registry.access.redhat.com/rhscl/postgresql-10-rhel7
    newTag: 1-35
  # FIXME(alecmerdler): Need to handle `redhat-pull-secret` (potentially with a `secretGenerator`?)...
